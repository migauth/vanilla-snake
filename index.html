<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game</title>
    <!-- <link href="style.css" rel="stylesheet"></link> -->
    <style>
      body {
        background-color: darkslategrey;
        height: 100vh;
        width: auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #game-board {
        background-color: lightgrey;
      }

      #score {
        color: yellow;
        padding-top: 10px;
        font-size: 200%;
      }

      #reset {
        color: white;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <!-- Can use a div here with an id indtead of canvas, or canvas -->
    <div>
      <canvas width="500" height="500" id="game-board"></canvas>
      <div id="score">score: <span id="scoreNum"></span></div>
    </div>
  </body>
  <script>
    // Need a game loop, update function, draw function
    // usually separation of concerns comes into play for snake, input
    // lots of accessing the window
    // x and y coodinates

    /**
     * List of functions
     * - game loop
     * - draw funtion
     * - snake
     * - input direciton
     * - food
     * - game over
     * - points
     * -
     */

    // basic game stuff

    const gameBoard = document.getElementById("game-board");
    const context = gameBoard.getContext("2d");

    const unitSize = 25;

    let running = false;

    let score = 0;
    const scoreNum = document.getElementById("scoreNum");
    const scoreDiv = document.getElementById("score");

    let direciton = "";

    console.log(score);

    // game board

    const gameBoardColour = "lightgrey";

    // snake and movement

    let xVelocity = unitSize;
    let yVelocity = 0;

    const snakeColour = "purple";
    let snake = [
      { x: unitSize * 2, y: 0 },
      { x: unitSize, y: 0 },
      { x: 0, y: 0 },
    ];

    function moveSnake() {
      let head = { x: snake[0].x + xVelocity, y: snake[0].y + yVelocity };
      snake.unshift(head);
      snake.pop()
    }

    console.log(snake);

    function snakeBody() {
      // first two are the x and y, second two are width and height

      snake.forEach((snakeParts) => {
        context.fillStyle = "black";
        context.fillRect(snakeParts.x, snakeParts.y, unitSize, unitSize);
        context.fillStyle = snakeColour;
        context.fillRect(
          snakeParts.x + 2.5,
          snakeParts.y + 2.5,
          unitSize - 5,
          unitSize - 5
        );
      });
    }

    // food

    // food starting point
    let foodPosition = { x: 100, y: 100 };

    function foodPositionCalc() {
      let max = 20;
      let min = 0;
      let randomX = Math.floor(Math.random() * (max - min)) * 25;
      let randomY = Math.floor(Math.random() * (max - min)) * 25;

      return [randomX, randomY];
    }

    function drawFood() {
      context.fillStyle = "yellow";
      context.fillRect(foodPosition.x, foodPosition.y, unitSize, unitSize);
    }

    // controls

    function changeDirection(e) {
      const keyPress = e.key;
      if (keyPress === "ArrowUp" || keyPress === "w") {
        yVelocity = -unitSize;
        xVelocity = 0
      }
      if (keyPress === "ArrowDown") {
        yVelocity = unitSize;
        xVelocity = 0
      }
      if (keyPress === "ArrowLeft") {
        xVelocity = -unitSize;
        yVelocity = 0;
      }
      if (keyPress === "ArrowRight") {
        xVelocity = unitSize;
        yVelocity = 0;
      }
    }

    window.addEventListener("keydown", changeDirection);

    // clear game screen
    function clear() {
      context.fillStyle = gameBoardColour;
      context.fillRect(0, 0, gameBoard.width, gameBoard.height);
    }

    // game loop

    function gameLoop() {
      running = true;

      updateGame();
    }

    function updateGame() {
      console.log(snake[snake.length - 1].x, snake[snake.length - 1].y);
      console.log(snake.length);

      if (running) {
        if (snake[0].x === foodPosition.x && snake[0].y === foodPosition.y) {
          console.log("yumyum");
          let positions = foodPositionCalc();
          console.log("positions", positions);
          foodPosition.x = positions[0];
          foodPosition.y = positions[1];
          console.log("1food x", foodPosition.x, "1food y", foodPosition.y);
          score = score + 1;
          snakeLength = snakeLength + 1;
        }
        if (snake[0].x < 0 || snake[0].x > 475) {
          running = false;
          scoreDiv.innerText = "game over";
          setTimeout(() => {
            location.reload();
          }, 2000);
        } else if (snake[0].y < 0 || snake[0].y > 475) {
          running = false;
          scoreDiv.innerText = "game over";
          setTimeout(() => {
            location.reload();
          }, 2000);
        }
        setTimeout(() => {
          clear();
          drawFood();
          snakeBody();
          moveSnake();
          // snake.pop()

          scoreNum.innerText = score;
          updateGame();
        }, 100);
      }
    }

    gameLoop();
  </script>
</html>
